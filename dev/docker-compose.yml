name: dcdev
services:
  dc-db:
    image: postgres:16
    container_name: dc-dev-db
    environment:
      POSTGRES_DB: dc_dev
      POSTGRES_USER: dc
      POSTGRES_PASSWORD: dcpass
    volumes:
      - ./pgdata:/var/lib/postgresql/data
    restart: unless-stopped

  dc-redis:
    image: redis:7
    container_name: dc-dev-redis
    command: ["redis-server", "--save", "60", "100", "--loglevel", "warning"]
    volumes:
      - ./redisdata:/data
    restart: unless-stopped

  dc-api:
    image: deep-calm-api:dev
    build:
      context: ..
      dockerfile: Dockerfile.api
    container_name: dc-dev-api
    command: ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    environment:
      DC_ENV: dev
      DC_DB_URL: postgresql://dc:dcpass@dc-db:5432/dc_dev
      DC_REDIS_URL: redis://dc-redis:6379/0
      DATABASE_URL: postgresql://dc:dcpass@dc-db:5432/dc_dev
      UVICORN_HOST: 0.0.0.0
      UVICORN_PORT: "8000"
      PYTHONPATH: /app
    ports:
      - "127.0.0.1:8082:8000"
    depends_on:
      - dc-db
      - dc-redis
    restart: unless-stopped

  dc-admin:
    image: deep-calm-frontend:dev
    build:
      context: ..
      dockerfile: Dockerfile.frontend
    container_name: dc-dev-admin
    environment:
      VITE_API_URL: http://dc-dev-api:8000
    ports:
      - "127.0.0.1:8083:3000"
    depends_on:
      - dc-api
    restart: unless-stopped
