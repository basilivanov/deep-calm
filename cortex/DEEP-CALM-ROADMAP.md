# DeepCalm — Product Roadmap (Фазы 1-4)

## Фаза 1: Publishing Automation (Текущий MVP)
**Цель:** Запустить рекламу на 3 площадках с единой аналитикой
**Сроки:** 2-3 недели
**Статус:** В разработке

### Функционал:
- ✅ Управление кампаниями (create/edit/pause)
- ✅ Генерация креативов (mock LLM → 3 варианта A/B/C)
- ✅ Публикация на VK/Директ/Avito (mock коннекторы)
- ✅ Dashboard: CAC, Conv%, ДРР (графики за 30д)
- ✅ Интеграции: YCLIENTS (записи), Метрика (оффлайн-конверсии)

### Ограничения MVP:
- Креативы генерируются с placeholder-текстом (реальная генерация — Фаза 3)
- VK Ads через mock-коннектор (нет доступа к API)
- Avito — ручной экспорт статистики (нет API)

---

## Фаза 1.5: AI Аналитик & Настраиваемые параметры
**Цель:** Автоматизировать анализ данных и сделать систему гибко настраиваемой
**Сроки:** 1-2 недели после первых 7 дней работы кампаний
**Статус:** Запланировано

### 1.5.1. Настраиваемые параметры (Settings)

**Проблема:** Все параметры захардкожены в коде (target_cac_rub=500, target_drr=0.20 и т.д.). Нужна гибкая настройка через админку.

**Решение:** Таблица `settings` с key-value парами + UI для редактирования.

**Категории параметров:**

1. **Финансовые показатели:**
   - `target_monthly_revenue_rub` — целевая выручка/месяц (100000₽ → показывается как спидометр)
   - `target_cac_rub` — целевой CAC (500₽ → можно увеличить если не укладываемся)
   - `target_drr` — целевой ДРР (20%)
   - `max_daily_spend_per_channel_rub` — лимит на канал в день (2000₽)

2. **Ценообразование по SKU:**
   - `sku_relax60_price_rub` — цена RELAX-60 (3500₽)
   - `sku_relax90_price_rub` — цена RELAX-90 (4800₽)
   - `sku_deep90_price_rub` — цена DEEP-90 (4200₽)
   - `sku_therapy60_price_rub` — цена THERAPY-60 (4200₽)

3. **Операционные лимиты:**
   - `max_monthly_clients` — максимум клиентов в месяц (80) — при переборе поднимаем цены
   - `workload_capacity_hours_per_month` — пропускная способность (160 часов)

4. **Алерты и пороги:**
   - `alert_cac_threshold_rub` — отправить алерт если CAC > 700₽
   - `alert_drr_threshold` — алерт при ДРР > 25%
   - `pause_campaign_if_cac_exceeds_rub` — автопауза при CAC > 1000₽

5. **AI поведение:**
   - `chatbot_confidence_threshold` — порог уверенности чатбота (0.70 → эскалация при < 70%)
   - `creative_generation_temp` — креативность GPT-4 (0.8)
   - `analyst_report_schedule_cron` — расписание отчётов (каждый понедельник 9:00)

**UI:**
- Страница `/settings` с табами по категориям (Финансы / Цены / Алерты / AI / Операционные)
- Circular Progress Bar для `target_monthly_revenue_rub` (спидометр выручки)
- Inline-редактирование каждой настройки с кнопкой "Сохранить"

**API:**
- `GET /api/v1/settings` — все настройки
- `PUT /api/v1/settings/{key}` — обновить настройку

### 1.5.2. AI Аналитик

**Проблема:** Нужен анализ данных, рекомендации по оптимизации, ответы на произвольные вопросы.

**Решение:** AnalystAgent — AI-агент с доступом к БД + GPT-4.

**Функции:**

1. **Еженедельные отчёты (каждый понедельник 9:00):**
   - Загружает данные за последние 7 дней (spend, leads, conversions по каналам)
   - Сравнивает с целевыми показателями из `settings`
   - Генерирует через GPT-4:
     - Краткое резюме (2-3 предложения)
     - Анализ по каналам (VK: good/bad, comment)
     - Проблемы (["CAC на VK выше на 40%", "Конверсия Avito упала"])
     - Рекомендации ([{"action": "увеличить бюджет VK на 30%", "reason": "...", "expected_impact": "..."}])
     - Предлагаемые изменения настроек ([{"key": "target_cac_rub", "current": 500, "proposed": 600, "reason": "..."}])
   - Сохраняет в таблицу `analyst_reports`
   - Отправляет уведомление в Telegram владельцу

2. **Интерактивный чат (ad-hoc запросы):**
   - Пользователь спрашивает: "Какой канал самый эффективный в сентябре?"
   - AI генерирует SQL-запрос → выполняет → анализирует результат → отвечает на русском языке (2-4 предложения)

3. **Автоматические действия:**
   - Если AI обнаруживает CAC > `pause_campaign_if_cac_exceeds_rub` → автопауза кампании + алерт в Telegram

**UI:**
- Страница `/analyst` с тремя блоками:
  1. **Последний отчёт** (резюме, проблемы, рекомендации с кнопками "Применить")
  2. **Интерактивный чат** (текстовое поле для вопросов)
  3. **Архив отчётов** (таблица прошлых отчётов)

**API:**
- `GET /api/v1/analyst/reports` — список отчётов
- `GET /api/v1/analyst/reports/{id}` — детали отчёта
- `POST /api/v1/analyst/generate` — принудительно сгенерировать отчёт
- `POST /api/v1/analyst/query` — задать вопрос AI

**Примеры использования:**

```python
# Еженедельный отчёт (nightly job)
@scheduler.scheduled_job('cron', day_of_week='mon', hour=9, minute=0)
async def weekly_analyst_report():
    agent = AnalystAgent()
    report = await agent.generate_weekly_report()
    await send_telegram_message(f"📊 Отчёт: {report['summary']}")

# Автопауза кампании при высоком CAC
async def check_cac_thresholds():
    settings = await get_settings()
    threshold = int(settings['pause_campaign_if_cac_exceeds_rub'])

    for campaign in active_campaigns:
        cac = calculate_cac(campaign.id)
        if cac > threshold:
            campaign.status = 'paused'
            await send_alert(f"⚠️ Кампания '{campaign.title}' приостановлена: CAC {cac}₽ > {threshold}₽")
```

**База данных:**
```sql
CREATE TABLE settings (
  key VARCHAR(100) PRIMARY KEY,
  value TEXT NOT NULL,
  value_type VARCHAR(20) NOT NULL, -- 'int', 'float', 'string', 'bool'
  category VARCHAR(50) NOT NULL,
  description TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  updated_by VARCHAR(50) DEFAULT 'admin'
);

CREATE TABLE analyst_reports (
  id SERIAL PRIMARY KEY,
  report_type VARCHAR(50) NOT NULL, -- 'weekly', 'monthly', 'ad_hoc'
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  summary TEXT,
  problems JSONB,
  recommendations JSONB,
  settings_changes JSONB,
  channel_analysis JSONB,
  generated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## Фаза 2: AI Assistant & Omnichannel Inbox
**Цель:** Автоматизировать общение с клиентами через боты + fallback на владельца
**Сроки:** 3-4 недели после Фазы 1
**Статус:** Запланировано

### 2.1. Чат-боты (AI-ассистент)
**Каналы:**
- 🌐 **Сайт (Tilda)** — виджет чата (iframe/WebSocket)
- 💬 **VK Сообщения** — бот через VK Messages API
- 📱 **Telegram** — бот для клиентов (запись на массаж)
- 🛒 **Avito Messenger** — автоответы на сообщения по объявлениям
- 📞 **WhatsApp Business** (опционально, Фаза 3)

**Функции AI-ассистента:**
1. **Ответы на вопросы:**
   - "Сколько стоит массаж?" → из прайс-листа (YCLIENTS или БД)
   - "Какие услуги есть?" → список SKU
   - "Где находитесь?" → адрес кабинета
   - "Есть противопоказания?" → из FAQ (Cortex knowledge base)

2. **Запись на массаж:**
   - "Хочу записаться на RELAX-60" → проверка свободных слотов (YCLIENTS API)
   - "Во вторник в 18:00 свободно?" → да/нет + альтернативы
   - Создание записи → подтверждение → SMS/уведомление

3. **Контекст разговора:**
   - История диалога (последние 10 сообщений)
   - UTM-метки (откуда пришёл клиент)
   - Предыдущие записи (если клиент постоянный)

### 2.2. Fallback на владельца (Василий)
**Триггеры для эскалации:**
- **Ключевые слова:** "позови Василия", "хочу с владельцем", "оператор", "человек"
- **Неуверенность LLM:** confidence < 70% (модель не знает ответа)
- **Сложные вопросы:** требуется персонализация (специальная услуга, скидка)
- **Жалоба/конфликт:** негативная тональность сообщения

**Механизм fallback:**
1. Бот: _"Сейчас свяжу вас с Василием. Он ответит в ближайшее время."_
2. Уведомление в **Telegram Василия:**
   ```
   🔔 Новое сообщение от клиента!
   Канал: VK (Иван Петров)
   Вопрос: "Можно ли записаться на TANTRA-120?"
   История: [последние 3 сообщения]

   [Ответить] [Игнорировать] [Передать боту]
   ```
3. **Проверка расписания YCLIENTS:**
   - Если Василий сейчас на массаже → автоответ: _"Василий на сеансе до 18:30. Свяжется сразу после."_
   - Если свободен → пушит уведомление в реалтайме

4. **Ответ через Telegram:**
   - Василий пишет в Telegram → система отправляет в исходный канал (VK/Avito/Сайт)
   - Прокси-режим: все сообщения туда-обратно идут через одно окно в Telegram

### 2.3. Inbox (Единое окно сообщений)
**Интерфейс в админке:**
```
┌─────────────────────────────────────────────────────┐
│ Inbox (12 новых)                    [VK] [Avito] [Сайт] │
├─────────────────────────────────────────────────────┤
│ 🟢 Иван Петров (VK)              2 мин назад      │
│    "Можно записаться на завтра?"                    │
│    [AI отвечает...]                                 │
├─────────────────────────────────────────────────────┤
│ 🔴 Мария Иванова (Avito)         Требует внимания │
│    "Это правда без боли?"                           │
│    Ожидает ответа владельца                         │
│    [Ответить]                                       │
├─────────────────────────────────────────────────────┤
│ 🟡 Сергей (Сайт)                 15 мин назад      │
│    "Сколько стоит DEEP-90?"                         │
│    AI: "Глубокий массаж 90 минут стоит 4500₽"      │
│    [Завершён]                                       │
└─────────────────────────────────────────────────────┘
```

**Фильтры:**
- Статус: Требует внимания / AI отвечает / Завершён
- Канал: VK / Avito / Сайт / TG
- Дата: Сегодня / Вчера / Неделя

### 2.4. Техническая архитектура

#### Схема БД (дополнения):
```sql
-- Таблица: conversations (диалоги)
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  channel VARCHAR(20) NOT NULL, -- vk, avito, website, telegram
  external_user_id TEXT NOT NULL, -- ID пользователя в канале
  user_name TEXT,
  lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,
  status VARCHAR(20) DEFAULT 'active', -- active|waiting_owner|closed
  assigned_to VARCHAR(20), -- 'bot'|'owner'
  utm_source VARCHAR(50),
  utm_campaign VARCHAR(100),
  started_at TIMESTAMPTZ DEFAULT NOW(),
  last_message_at TIMESTAMPTZ,
  UNIQUE(channel, external_user_id)
);

-- Таблица: messages (сообщения)
CREATE TABLE messages (
  id SERIAL PRIMARY KEY,
  conversation_id UUID REFERENCES conversations(id) ON DELETE CASCADE,
  sender VARCHAR(20), -- bot|owner|client
  content TEXT NOT NULL,
  attachments JSONB, -- [{type: 'image', url: '...'}]
  ai_confidence NUMERIC(5,4), -- 0.95 (уверенность LLM)
  requires_escalation BOOLEAN DEFAULT FALSE,
  sent_at TIMESTAMPTZ DEFAULT NOW()
);

-- Таблица: bot_knowledge (база знаний для бота)
CREATE TABLE bot_knowledge (
  id SERIAL PRIMARY KEY,
  category VARCHAR(50), -- faq|services|pricing|location
  question TEXT NOT NULL,
  answer TEXT NOT NULL,
  keywords TEXT[], -- для семантического поиска
  enabled BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### API Endpoints:
```python
# Чат-боты
POST /api/v1/chatbot/webhook/vk — вебхук VK Messages
POST /api/v1/chatbot/webhook/avito — вебхук Avito Messenger
POST /api/v1/chatbot/webhook/telegram — вебхук Telegram
POST /api/v1/chatbot/message — отправить сообщение от бота

# Inbox (админка)
GET /api/v1/inbox/conversations?status=waiting_owner — список диалогов
GET /api/v1/inbox/conversations/{id}/messages — история диалога
POST /api/v1/inbox/conversations/{id}/reply — ответить от владельца
POST /api/v1/inbox/conversations/{id}/assign — передать боту/владельцу

# Fallback
POST /api/v1/inbox/escalate — эскалировать на владельца (+ Telegram уведомление)
GET /api/v1/inbox/owner/schedule — расписание из YCLIENTS
```

#### Интеграции:
1. **VK Messages API:**
   - Callback API для входящих сообщений
   - `messages.send` для ответов
   - Получение истории диалога

2. **Avito Messenger API:**
   - Webhook для новых сообщений по объявлениям
   - `POST /messenger/v1/accounts/{account_id}/chats/{chat_id}/messages`

3. **Telegram Bot API:**
   - Webhook для клиентского бота (запись на массаж)
   - Отдельный бот для Василия (Inbox proxy)

4. **Website Widget (Tilda):**
   - Встраиваемый iframe `<iframe src="https://dev.dc.vasiliy-ivanov.ru/chat"></iframe>`
   - WebSocket для реалтайм-чата
   - Fallback на polling (если WebSocket недоступен)

#### LLM Промпт для AI-ассистента:
```markdown
Ты — ассистент массажного кабинета DeepCalm (Москва).
Владелец: Василий, мастер с опытом 2 года.

Твоя задача:
1. Отвечать на вопросы клиентов (услуги, цены, расположение, противопоказания)
2. Помогать записаться на массаж (проверка свободных слотов через YCLIENTS API)
3. Быть вежливым, спокойным, избегать медицинских терминов

Тон: {из cortex/brandbook/tone.md}
База знаний: {из bot_knowledge}
Прайс-лист: {из БД или YCLIENTS}

Если не знаешь ответа → скажи "Сейчас уточню у Василия" + эскалация.
Если клиент просит Василия → "Свяжу вас с владельцем" + fallback.
```

---

## Фаза 3: AI Creative Generation (Vision → Ads)
**Цель:** Генерировать креативы автоматически из фотографий студии
**Сроки:** 2-3 недели после Фазы 2
**Статус:** Запланировано

### 3.1. Проблема
Сейчас креативы генерируются с placeholder-текстом. Нужно:
- Использовать **реальные фотографии** студии (интерьер, атмосфера, руки массажиста)
- Генерировать **тексты объявлений** на основе изображения + brandbook
- Проходить **модерацию** VK/Avito/Директ (без стоп-слов типа "тантра", "эротический")

### 3.2. Архитектура генерации

#### Шаг 1: Анализ изображений (Vision AI)
**Инструменты:**
- **Google Cloud Vision API** — распознавание объектов, цветов, атмосферы
- **OpenAI GPT-4 Vision** — описание сцены на естественном языке
- Альтернатива: **Yandex Vision API** (если нужна локализация в РФ)

**Пример:**
```python
# app/services/image_analyzer.py
async def analyze_image(image_url: str) -> dict:
    # Google Vision API
    response = vision_client.annotate_image({
        'image': {'source': {'image_uri': image_url}},
        'features': [
            {'type': 'LABEL_DETECTION'},
            {'type': 'IMAGE_PROPERTIES'},
            {'type': 'SAFE_SEARCH_DETECTION'}
        ]
    })

    labels = [label.description for label in response.label_annotations]
    colors = response.image_properties_annotation.dominant_colors.colors
    safe_search = response.safe_search_annotation

    # GPT-4 Vision для описания
    gpt_description = await openai.ChatCompletion.create(
        model="gpt-4-vision-preview",
        messages=[{
            "role": "user",
            "content": [
                {"type": "text", "text": "Опиши атмосферу этой фотографии массажного кабинета в 2-3 предложениях. Используй спокойный тон."},
                {"type": "image_url", "image_url": {"url": image_url}}
            ]
        }]
    )

    return {
        "labels": labels,  # ['massage', 'spa', 'candles', 'calm']
        "dominant_color": colors[0].color,  # RGB(247, 245, 242) — бежевый
        "safe_for_ads": safe_search.adult == 'VERY_UNLIKELY',
        "description": gpt_description.choices[0].message.content
    }
```

**Вывод:**
```json
{
  "labels": ["massage", "spa", "candles", "relaxation", "calm"],
  "dominant_color": {"r": 247, "g": 245, "b": 242},
  "safe_for_ads": true,
  "description": "Уютный кабинет с мягким освещением и свечами. Бежевые тона создают атмосферу тишины и расслабления."
}
```

#### Шаг 2: Генерация текста объявления
**Промпт для LLM (GPT-4 или Claude):**
```markdown
Ты — копирайтер рекламных объявлений для массажного кабинета DeepCalm.

Входные данные:
- Фото: {description из Vision API}
- SKU: RELAX-60 (Расслабляющий массаж, 60 минут, 3500₽)
- Brandbook: {cortex/brandbook/creative_rules.md}
- Площадка: VK Ads (лимит: заголовок 33 символа, текст 90 символов)

Требования:
1. Используй тон из brandbook: "Мягко. Без боли. Тишина на час."
2. Избегай стоп-слов модерации: "эротический", "интимный", "тантра"
3. CTA: "Записаться на сеанс"
4. Акцент на атмосферу (из описания фото)

Сгенерируй 3 варианта (A/B/C):
- Вариант A: Эмоциональный (фокус на ощущениях)
- Вариант B: Рациональный (цена/время/польза)
- Вариант C: Социальное доказательство (отзывы/опыт)
```

**Вывод (3 креатива):**
```json
[
  {
    "variant": "A",
    "title": "Час тишины в уютном кабинете",
    "body": "Мягкое освещение, свечи и профессиональные руки. Расслабляющий массаж 60 минут — 3500₽.",
    "cta": "Записаться на сеанс",
    "image_url": "https://storage.yandexcloud.net/dc-media/relax-60-a.jpg"
  },
  {
    "variant": "B",
    "title": "Расслабляющий массаж — 3500₽",
    "body": "60 минут глубокого расслабления. Кабинет в центре Москвы. Запись онлайн.",
    "cta": "Узнать свободное время",
    "image_url": "https://storage.yandexcloud.net/dc-media/relax-60-b.jpg"
  },
  {
    "variant": "C",
    "title": "Попробуйте авторский массаж",
    "body": "Василий, мастер с 2-летним опытом. 50+ довольных клиентов. Первый сеанс со скидкой 10%.",
    "cta": "Записаться сейчас",
    "image_url": "https://storage.yandexcloud.net/dc-media/relax-60-c.jpg"
  }
]
```

#### Шаг 3: Модерационная проверка (pre-flight)
**Фильтры перед публикацией:**
```python
# app/services/moderation.py
STOP_WORDS_VK = ['эротический', 'интимный', 'тантра', 'йони', 'лингам']
STOP_WORDS_AVITO = ['эротический', 'интимный', 'секс', 'интим-услуги']
STOP_WORDS_DIRECT = ['эротика', 'xxx', '18+']

async def check_moderation(creative: dict, channel: str) -> dict:
    text = f"{creative['title']} {creative['body']}".lower()

    stop_words = {
        'vk': STOP_WORDS_VK,
        'avito': STOP_WORDS_AVITO,
        'direct': STOP_WORDS_DIRECT
    }[channel]

    violations = [word for word in stop_words if word in text]

    if violations:
        return {"approved": False, "reason": f"Стоп-слова: {', '.join(violations)}"}

    # Проверка через OpenAI Moderation API (опционально)
    moderation = await openai.Moderation.create(input=text)
    if moderation.results[0].flagged:
        return {"approved": False, "reason": "Flagged by OpenAI Moderation"}

    return {"approved": True}
```

#### Шаг 4: Хранение медиа (изображения)
**Варианты:**
1. **Yandex Object Storage** (S3-compatible) — основной для РФ
2. **Cloudflare R2** — бэкап + CDN
3. **Локальное хранилище** — для dev/test

**Структура:**
```
vasiliy-ivanov-dc-media/
  photos/
    original/
      massage-room-1.jpg
      massage-room-2.jpg
      hands-closeup.jpg
    processed/
      massage-room-1-compressed.jpg (для объявлений)
  creatives/
    campaign-uuid/
      variant-a.jpg
      variant-b.jpg
      variant-c.jpg
```

### 3.3. UI для управления медиа

**Новая страница в админке: "Media Library"**
```
┌──────────────────────────────────────────────────────┐
│ Media Library (12 фото)         [Загрузить] [Анализ]│
├──────────────────────────────────────────────────────┤
│ [Фото 1: Кабинет с свечами]   Загружено: 01.09.2025 │
│   📊 Анализ: massage, spa, candles, calm             │
│   🎨 Цвет: Бежевый (#F7F5F2)                         │
│   ✅ Безопасно для модерации                          │
│   [Создать креатив] [Удалить]                        │
├──────────────────────────────────────────────────────┤
│ [Фото 2: Руки массажиста]     Загружено: 05.09.2025 │
│   📊 Анализ: hands, massage, professional            │
│   ⚠️  Требует проверки (недостаточно света)          │
│   [Создать креатив] [Редактировать]                  │
└──────────────────────────────────────────────────────┘
```

**Процесс:**
1. Василий загружает фото → автоматический анализ (Vision API)
2. Выбирает фото → "Создать креатив" → выбирает SKU + площадки
3. LLM генерирует 3 варианта → модерационная проверка
4. Василий просматривает → редактирует (при необходимости) → публикует

---

## Фаза 4: Advanced Analytics & Optimization
**Цель:** Автоматическая оптимизация ставок + predictive analytics
**Сроки:** 4-6 недель после Фазы 3
**Статус:** Запланировано

### 4.1. Mini-Bidder (автоматические ставки)
**Логика:**
- Если CAC > 500₽ на кампании → снизить ставку на 10%
- Если Conv% < 2% → пауза кампании + алерт
- Если ДРР > 20% → перераспределить бюджет на топ-креатив

### 4.2. Predictive Cohort TTP
**Задача:** Предсказать Conv_D30 на основе Conv_D7
**Модель:** Linear Regression или XGBoost на исторических данных

### 4.3. Automated A/B Test Winner
**Критерий:** Chi-square test (статистическая значимость Conv%)
**Действие:** Автоматически отключать проигравшие варианты после 100 кликов

---

## Admin UI Design (Современный/Визуальный)

### Инспирация: Feature-Factory Frontend
**Что взять:**
- Тёмная/светлая тема (toggle)
- Анимации (плавные переходы, микроинтеракции)
- Консистентный UI kit (кнопки, формы, таблицы)

### Компоненты (расширенные)

#### 1. Dashboard (главная)
```
┌─────────────────────────────────────────────────────────────┐
│ 📊 Dashboard                             [Dev ▼] [Период: 30д▼] │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐            │
│ │ Расход  │ │ Лиды    │ │ Конв.   │ │ CAC     │            │
│ │ 45,000₽ │ │ 92      │ │ 18      │ │ 489₽    │            │
│ │ ▲ 12%   │ │ ▲ 8%    │ │ ▼ 5%    │ │ ▼ 3%    │            │
│ │ Sparkline│ │Sparkline│ │Sparkline│ │Sparkline│            │
│ └─────────┘ └─────────┘ └─────────┘ └─────────┘            │
├─────────────────────────────────────────────────────────────┤
│ 📈 CAC по каналам (30 дней)                                │
│   ┌──────────────────────────────────────────────────────┐ │
│   │ 600₽─┤                                    ●          │ │
│   │ 500₽─┤              ●───●───●───●       ●            │ │
│   │ 400₽─┤    ●───●───●                   ●              │ │
│   │ 300₽─┤●───                                            │ │
│   │      └─┬───┬───┬───┬───┬───┬───┬───┬───┬───┬────    │ │
│   │        1   5   10  15  20  25  30                    │ │
│   │   ─── VK Ads    ─── Директ    ─── Avito             │ │
│   └──────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 🎯 Конверсия по кампаниям                                  │
│   ┌────────────────────────────────────────┐              │
│   │ Запуск сентябрь — Релакс (VK)         │              │
│   │ ████████████████░░░░░░░░░░ 65%          │  ←Прогресс-бар│
│   │ Клики: 450  →  Конв: 12  →  CAC: 475₽  │              │
│   └────────────────────────────────────────┘              │
│   ┌────────────────────────────────────────┐              │
│   │ Avito — Глубокий массаж                │              │
│   │ ██████████░░░░░░░░░░░░░░░░ 40%          │              │
│   │ Клики: 320  →  Конв: 6   →  CAC: 520₽  │              │
│   └────────────────────────────────────────┘              │
└─────────────────────────────────────────────────────────────┘
```

**Элементы UI:**
- **Sparklines** (мини-графики в карточках) — библиотека `recharts` или `visx`
- **Прогресс-бары** — показывают % от целевой конверсии (напр. цель 70%, сейчас 65%)
- **Tooltips** — при наведении на точку графика → детали (дата, значение, клики)
- **Анимации** — плавное появление карточек (fade-in), transition на графиках

#### 2. Campaigns Manager
```
┌─────────────────────────────────────────────────────────────┐
│ 🚀 Кампании (12 активных)        [+ Создать]  [Фильтры ▼]   │
├─────────────────────────────────────────────────────────────┤
│ Поиск: [_______________________]  Статус: [Все ▼] Канал: [Все ▼]│
├─────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────┐   │
│ │ ● Запуск сентябрь — Релакс            🟢 Активна      │   │
│ │   VK, Директ  |  Бюджет: 15,000₽  |  CAC: 475₽      │   │
│ │   ▓▓▓▓▓▓▓▓▓░░░░░  60% израсходовано                   │   │
│ │   [Пауза] [Редактировать] [Аналитика] [A/B тесты ↗]  │   │
│ └───────────────────────────────────────────────────────┘   │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ ● Avito — Глубокий массаж             🟡 Пауза        │   │
│ │   Avito  |  Бюджет: 10,000₽  |  CAC: 520₽           │   │
│ │   ▓▓▓▓░░░░░░░░░  35% израсходовано                     │   │
│ │   ⚠️  CAC выше целевого (цель: 500₽)                   │   │
│ │   [Запустить] [Редактировать] [Удалить]               │   │
│ └───────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

**Фишки UI:**
- **Цветовые индикаторы:** 🟢 активна, 🟡 пауза, 🔴 остановлена, ⚠️ проблема
- **Прогресс-бар бюджета:** показывает израсходованную часть
- **Алерты inline:** если CAC > target → жёлтый фон + иконка предупреждения
- **Quick actions:** наведение на кампанию → появляются кнопки [Пауза] [Аналитика]

#### 3. Creative A/B Tests
```
┌─────────────────────────────────────────────────────────────┐
│ 🎨 A/B тесты: "Запуск сентябрь — Релакс"     Период: 7 дней  │
├─────────────────────────────────────────────────────────────┤
│ ┌────────────┬────────────┬────────────┐                    │
│ │ Вариант A  │ Вариант B  │ Вариант C  │                    │
│ ├────────────┼────────────┼────────────┤                    │
│ │ [IMG]      │ [IMG]      │ [IMG]      │  ← Превью креативов│
│ │            │            │            │                    │
│ │ "Час тишины│ "Расслабл. │ "Авторский │                    │
│ │  в уютном  │  массаж—   │  массаж от │                    │
│ │  кабинете" │  3500₽"    │  мастера"  │                    │
│ ├────────────┼────────────┼────────────┤                    │
│ │ Клики: 180 │ Клики: 150 │ Клики: 120 │                    │
│ │ Конв: 8    │ Конв: 6    │ Конв: 4    │                    │
│ │ Conv%: 4.4%│ Conv%: 4.0%│ Conv%: 3.3%│                    │
│ │ 🏆 Лидер   │ 👍 Хорошо  │ 👎 Отстаёт │  ← Статус          │
│ │            │            │            │                    │
│ │ ┌────────┐ │ ┌────────┐ │ ┌────────┐ │  ← Круговые диаграммы│
│ │ │ ██ 44% │ │ │ ██ 40% │ │ │ ██ 33% │ │                    │
│ │ └────────┘ │ └────────┘ │ └────────┘ │                    │
│ │            │            │            │                    │
│ │ [Выбрать]  │ [Пауза]    │ [Остановить]│                   │
│ └────────────┴────────────┴────────────┘                    │
│                                                              │
│ 📊 Статистическая значимость: ✅ Достигнута (p=0.03)        │
│    Вариант A статистически лучше B и C. Рекомендуем         │
│    остановить C и перераспределить бюджет на A.             │
└─────────────────────────────────────────────────────────────┘
```

**Элементы:**
- **Превью креативов** — карточки с изображением + текстом
- **Круговые диаграммы** — Conv% в процентах (визуально сравнить)
- **Статусы с эмодзи** — 🏆 лидер, 👍 хорошо, 👎 отстаёт
- **Рекомендации AI** — блок с советами (на основе статистики)

#### 4. Inbox (Чат-боты, Фаза 2)
```
┌─────────────────────────────────────────────────────────────┐
│ 💬 Inbox (5 требуют внимания)    [VK] [Avito] [Сайт] [TG]   │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🔴 Мария Иванова (Avito)         ⏱️ Ожидает 15 мин      │ │
│ │ "Это правда без боли?"                                  │ │
│ │ AI-уверенность: 45% — требует вашего ответа             │ │
│ │ [Ответить] [Передать боту] [История ↗]                  │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🟢 Иван Петров (VK)              ⏱️ AI отвечает         │ │
│ │ "Можно записаться на завтра в 18:00?"                   │ │
│ │ AI: "Проверяю свободные слоты..."                       │ │
│ │ [Просмотреть]                                           │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 5. Integrations Page
```
┌─────────────────────────────────────────────────────────────┐
│ 🔌 Интеграции                                               │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ VK Ads             ✅ Подключено (OAuth)                 │ │
│ │ Токен: vk1.a.***...7Kx (скрыт)                          │ │
│ │ Последняя синхронизация: 2 часа назад                   │ │
│ │ [Переподключить] [Обновить токен] [Отключить]           │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ YCLIENTS           ✅ Подключено                         │ │
│ │ Company ID: 123456                                      │ │
│ │ Записей синхронизировано: 42 (сегодня)                 │ │
│ │ [Форсировать синхронизацию] [Настройки]                │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Яндекс.Метрика     ⚠️  Требует настройки                │ │
│ │ Counter ID: [___________]  [Сохранить]                  │ │
│ │ OAuth токен: [___________]  [Получить токен ↗]          │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### UI Kit (компоненты)
**Библиотеки:**
- **shadcn/ui** (Radix UI + Tailwind) — базовые компоненты
- **Recharts** — графики (линейные, круговые, bar charts)
- **Visx** — sparklines (мини-графики)
- **Framer Motion** — анимации (fade-in, slide-in)
- **React Hot Toast** — уведомления (success/error)

**Цветовая схема (из DeepCalm brandbook):**
```css
:root {
  --dc-bg: #F7F5F2;       /* Бежевый фон */
  --dc-primary: #6B4E3D;  /* Коричневый основной */
  --dc-ink: #262626;      /* Текст */
  --dc-accent: #A67C52;   /* Акцентный (кнопки) */
  --dc-success: #10B981;  /* Зелёный (успех) */
  --dc-warning: #F59E0B;  /* Жёлтый (предупреждение) */
  --dc-error: #EF4444;    /* Красный (ошибка) */
}
```

**Типографика:**
- Заголовки: Inter (600), 24px/32px
- Тело: Inter (400), 16px/24px
- Монопространственный (коды/токены): JetBrains Mono

---

## Итого: что заложено

✅ **Фаза 1** — Publishing (реализуется сейчас)
✅ **Фаза 2** — Чат-боты + AI-ассистент + Inbox + Fallback на Василия
✅ **Фаза 3** — AI-генерация креативов из фотографий (Vision → GPT-4 → модерация)
✅ **Фаза 4** — Автооптимизация ставок + predictive analytics

**Инфраструктура готова к масштабированию**, код будет писаться постепенно по фазам.